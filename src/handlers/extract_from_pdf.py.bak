"""
M√≥dulo de Extra√ß√£o de Texto de PDF
Respons√°vel por processar PDFs e converter para texto com marcadores de p√°gina
"""

import pdfplumber


def extract_text_from_pdf_local(pdf_path: str, verbose: bool = True) -> str:
    """
    Extrai texto de um PDF local com anima√ß√£o de progresso.
    
    Args:
        pdf_path: Caminho do arquivo PDF
        verbose: Se True, mostra progresso no terminal
        
    Returns:
        str: Texto extra√≠do com marcadores de p√°gina
    """
    with pdfplumber.open(pdf_path) as pdf:
        total_paginas = len(pdf.pages)
        text_parts = []
        
        for i, p in enumerate(pdf.pages):
            if verbose:
                pct = (i + 1) / total_paginas * 100
                barra = '‚ñà' * int(pct / 5) + '‚ñë' * (20 - int(pct / 5))
                print(
                    f"\rüìÑ Extraindo texto: p√°gina {i+1}/{total_paginas} "
                    f"[{pct:5.1f}%] {barra}",
                    end="",
                    flush=True
                )
            
            texto = p.extract_text(layout=True) or ''
            text_parts.append(f"[[PAGINA:{i+1}]]\n{texto}")
        
        if verbose:
            print()  # Nova linha ap√≥s a barra de progresso
            
        return "\n\n".join(text_parts)